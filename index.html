<html>

    <head>
        <script
            type="text/javascript"
            src="https://cdn.jsdelivr.net/npm/brython@3.10.3/brython.min.js">
        </script>
        <script
            type="text/javascript"
            src="https://cdn.jsdelivr.net/npm/brython@3.10.3/brython_stdlib.js">
        </script>
        <link rel="stylesheet" type="text/css" href="spelling-bee.css?v=1.3">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <link rel="stylesheet" type="text/css" href="foundation.css">
        <script>
            function displayLeaderboard(evt, name) {
                window.display_leaderboard(name);
            }
            
            window.display_leaderboard = function(name){
                var i, tabcontent, tablinks;
                tabcontent = document.getElementsByClassName("tabcontent");
                for (i = 0; i < tabcontent.length; i++) {
                    if (tabcontent[i].id == name)
                        tabcontent[i].style.display = "block";
                    else
                        tabcontent[i].style.display = "none";
                }
                tablinks = document.getElementsByClassName("tablinks");
                for (i = 0; i < tablinks.length; i++) {
                    if (tablinks[i].name == name)
                        tablinks[i].className += " active";
                    else
                        tablinks[i].className = tablinks[i].className.replaceAll(" active", "");
                }
            }
        </script>
        <script>

            if (location.protocol == 'https:') {
                window.location.href = window.location.href.replace(/^https:/, 'http:')
            }
        </script>
        <style>
            .custom-radios{
                position:absolute;
                top:6px;
                right: 6px;
            }

            .custom-radios div {
              justify-content: center;
              align-items: center;
              display: inline-block;
            }
            .custom-radios input[type=radio] {
              display: none;
            }
            .custom-radios input[type=radio] + label {
              color: #333;
              font-family: Arial, sans-serif;
              font-size: 14px;
            }
            .custom-radios input[type=radio] + label span {
              display: inline-block;
              width: 20px;
              height: 20px;
              margin: -1px 4px 0 0;
              vertical-align: middle;
              cursor: pointer;
              border-radius: 50%;
              border: 1px solid #aaaaaa;
              box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.33);
              background-repeat: no-repeat;
              background-position: center;
              text-align: center;
              line-height: 22px;
            }
            .custom-radios input[type=radio] + label span img {
              opacity: 0;
              transition: all 0.3s ease;
            }
            .custom-radios input[type=radio]#lang-en + label span {
              background-image: url("https://cdn-icons-png.flaticon.com/128/197/197374.png");
              background-size: 20px 20px;
            }
            .custom-radios input[type=radio]#lang-fr + label span {
              background-image: url("https://cdn-icons-png.flaticon.com/512/197/197560.png");
              background-size: 20px 20px;
            }
            .custom-radios input[type=radio]:checked + label span {
              opacity: 1;
              border: 2px solid #f7da21;
            }
        
            .w3-yellow      {color:#000!important;background-color:#f7da21!important}
            .w3-light-grey  {color:#000!important;background-color:#e6e6e6!important}
            
            #progress-bar { height:100%; }
            #progress-bar-container { position:relative; height:24px; }
            #progress-text-container { position:absolute; width:100%; height:100%; }
            #progress-text { position:relative; display:flex; height:100%; align-items:center; justify-content:center; }
        
            .sb-wordlist-drawer { position:relative; top:-45px; width:90% }
        
            .rainbow-text {
                background-image: linear-gradient(to left, violet, indigo, blue, green, #f7da21, orange, red);   -webkit-background-clip: text;
                color: transparent;
            }
            
            .w3-round-large {
                border-radius: 8px;
            }
        
            html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video {
                margin: 0;
                padding: 0;
                border: 0;
                font-size: 100%;
                font: inherit;
                vertical-align: baseline
            }
        
            .sb-controls-box {
                max-height: 500px;
            }
        
            .pz-game-field {
                padding-top: 20px;
            }
        
            .hive-action {
                height: 20px;
            }
            
            /* The Modal (background) */
            .modal {
              display: none; /* Hidden by default */
              position: fixed; /* Stay in place */
              z-index: 10; /* Sit on top */
              left: 0;
              top: 0;
              width: 100%; /* Full width */
              height: 100%; /* Full height */
              overflow: auto; /* Enable scroll if needed */
              background-color: rgb(0,0,0); /* Fallback color */
              background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            }

            /* Modal Content */
            .modal-content {
              background-color: #fefefe;
              margin: auto;
              padding: 20px;
              border: 1px solid #888;
              width: 80%;
              position: relative;
              top: 5%;
              height: 80%;
            }

            /* The Close Button */
            .close {
              color: #aaaaaa;
              float: right;
              font-size: 28px;
              font-weight: bold;
            }

            .close:hover,
            .close:focus {
              color: #000;
              text-decoration: none;
              cursor: pointer;
            }
            
            #username {
                padding: 0;
                border: 0;
                top: -5;
                position: relative;
                width: calc(100% - 55px);
            }
            
            
            
            /* Style the tab */
            .tab {
              overflow: hidden;
              border: 1px solid #ccc;
              background-color: #f1f1f1;
              display: flex;
            }

            /* Style the buttons inside the tab */
            .tab button {
              background-color: inherit;
              float: left;
              border: none;
              outline: none;
              cursor: pointer;
              padding: 14px 0px;
              transition: 0.3s;
            }

            /* Change background color of buttons on hover */
            .tab button:hover {
              background-color: #ddd;
            }

            /* Create an active/current tablink class */
            .tab button.active {
              background-color: #ccc;
            }

            /* Style the tab content */
            .tabcontent {
              display: none;
              padding: 6px 12px;
              border: 1px solid #ccc;
              border-top: none;
              height: calc(100% - 100px);
              overflow-y: scroll;
            }
            
            .tablinks {
                flex: 1;
            }
        
        </style>
            
    </head>

    <body onload="brython()">
        
        <script type="text/python">
        from browser import document, alert, html, load, window, timer
        from browser.local_storage import storage
        import urllib.request
        #import pydoc
        import random
        import os
        import sys
        import getopt
        import datetime
        import json
        import hashlib
        import unicodedata
        import math
        import time
        import locale
        
        load("bundle.js")
        
        UNIQUE_LETTERS_COUNT = 7

        CONGRATS_WORDS = ["Yes!", "Well done!", "Amazing!", "Fantastic!", "Fabulous!", "Wow!", "Perfect!"]
        INCORRECT_WORDS = ["Incorrect word", "Nope", "Not a word", "That's not a thing", "What's that?"]
        WRONG_LETTERS = ["Wrong letters", "That doesn't work", "Doesn't fit"]

        DEFAULT_WORD_LISTS={
            "fr": "https://raw.githubusercontent.com/hbenbel/French-Dictionary/master/dictionary/dictionary.txt",
            "en": "http://www.mieliestronk.com/corncob_lowercase.txt"
        }

        DEFAULT_LANGUAGE = "en"

        LOADING_BAR_LENGTH = 50

        KEY_PANGRAMS = "pangrams"
        KEY_OTHER_WORDS = "other_words"
        KEY_LETTERS = "letters"
        KEY_BEES = "bees"
        
        WEEKDAYS = ["mon", "tue", "wed", "thu", "fri", "sat", "sun"]
        
        ALL_TIMES_LEADERBOARD_ID = "all_time_points"
        DAILY_LEADERBOARD_ID = "daily_points"
        
        words_found = set()
        pangrams_found = set()
        letters_ordered = ""
        
        os.chdir(os.path.dirname(os.path.abspath(sys.argv[0])))

        def cls():
            print("cls")
            
        def get_loading_bar(loading_rate, bar_length):
            loading_bar = "["
            for i in range(0, bar_length):
                if i < loading_rate * bar_length:
                    loading_bar += "â–ˆ"
                else:
                    loading_bar += " "
            loading_bar += "]"
            return loading_bar

        def hash(s: str):
            return hashlib.sha1(s.encode('utf-8')).hexdigest()[:6]
            
        def words_path():
            return f"words_{language}.txt"
                
        def bees_path():
            return f"bees_{language}.txt"

        class Word:
            word: str
            letters: set
            
            def __init__(self, word: str, letters: set):
                self.word = word
                self.letters = letters
                

        def show_progress(block_num, block_size, total_size):
                    
            loading_rate = block_num * block_size / total_size
            loading_bar = get_loading_bar(loading_rate, LOADING_BAR_LENGTH)
            if loading_rate < 1:
                print(f"Downloading words: {loading_bar} {math.floor(loading_rate * 100)}%", end='\r')
            else:
                print(f"Downloading words: {loading_bar} 100%")

        def load_words(url: str):
            urllib.request.urlretrieve(url, words_path(), show_progress)
            word_file = open(words_path())
            content = word_file.read()
            content = unicodedata.normalize('NFD', content).encode('ascii', 'ignore').decode("utf-8")
            word_file = open(words_path(), "w")
            word_file.write(content)
            words = content.split()
            res = []
            for word in words:
                if len(word) >= 4 and len(set(word)) <= 7 and "'" not in word and "-" not in word:
                    res.append(Word(word, set(word)))
            return res
            
        def today_key() -> str:
            return WEEKDAYS[day_of_week]
            
        def yesterday_key() -> str:
            return WEEKDAYS[(day_of_week - 1) % 6]
            
        def get_leaderboard_id(day_key: str) -> str:
            return f"{DAILY_LEADERBOARD_ID}_{day_key}_{language}"
            
        def get_today_leaderboard_id() -> str:
            return get_leaderboard_id(today_key())
            
        def get_yesterday_leaderboard_id() -> str:
            return get_leaderboard_id(yesterday_key())
            
        def get_all_times_leaderboard_id() -> str:
            return f"{ALL_TIMES_LEADERBOARD_ID}_{language}"

        class Bee:
            letters: set
            center: str
            pangrams: set
            other_words: set
            
            def __init__(self, letters: set, center: str, pangrams: set, other_words: set):
                self.letters = letters
                self.center = center
                self.pangrams = pangrams
                self.other_words = other_words
                
            @staticmethod
            def create_bee(word: Word, words):
                print(f"create_bee({word})")
                res = set()
                if len(word.letters) == UNIQUE_LETTERS_COUNT:
                    pangrams = set()
                    all_other_words = set()
                    for w in words:
                        if w.letters == word.letters:
                            pangrams.add(w.word)
                        elif w.letters.issubset(word.letters):
                            all_other_words.add(w)
                    for center in sorted(word.letters):
                        other_words = set()
                        for w in all_other_words:
                            if center in w.letters:
                                other_words.add(w.word)
                        res.add(Bee(word.letters, center, pangrams, other_words))
                return res
                        
            @staticmethod
            def create_bees(words):
                bees = []
                index = 0
                used_letters = set()
                for word in words:
                    loading_rate = index / len(words)
                    loading_bar = get_loading_bar(loading_rate, LOADING_BAR_LENGTH)
                    print(f"Generating bees: {loading_bar} {math.floor(loading_rate * 100)}%", end = '\r')
                    if word.letters not in used_letters:
                        bee = Bee.create_bee(word, words)
                        if bee is not None:
                            bees.extend(list(bee))
                            used_letters.add(frozenset(word.letters))
                    index += 1
                print(f"Generating bees: {loading_bar} 100%")
                return bees
                
            def show_letters(self):
                print(f"show_letters({self.letters})")
                other_letters = self.letters - set(self.center)
                res = f"{self.center.upper()}{''.join(random.sample(list(l.upper() for l in other_letters),len(other_letters)))}"
                print(res)
                return res
            
            def __str__(self):
                return f"{self.show_letters()} -> {len(self.all_words())}: {','.join(self.pangrams)},{','.join(self.other_words)}"
                
            def all_words(self):
                return self.pangrams | self.other_words
                
            def is_pangram(self, word):
                return set(word) == self.letters
                
                  
        class HashedBee(Bee):
            
            def guess(self):
                words_count = len(self.all_words())
                words_found = set()
                pangrams_found = set()
                letters_ordered = self.show_letters()
                #while len(words_found) < words_count:
                    #try_guess(self)
                
            def try_guess(self, word):
                result = False
                word = word.lower()
                print(f"try_guess({word})")
                cls()
                print(f"{letters_ordered}")
                #print(f"{len(words_found)}/{words_count} words found: {','.join(sorted(words_found))}")
                #print(f"{len(pangrams_found)}/{len(self.pangrams)} pangrams found: {','.join(sorted(pangrams_found))}")
                #word = input()
                hash_word = str(hash(word))
                if verbose:
                    print(f"hash: {hash_word}")
                if word == "":
                    return
                #elif word == "s" or word == "r":
                #    letters_ordered = self.show_letters()
                #    continue
                elif len(word) < 4:
                    feedback("Word too short", True, False)
                elif word in words_found:
                    feedback("Word already found", True, False)
                elif self.center not in word:
                    feedback(f"Word missing the central letter ({self.center})", True, False)
                elif hash_word in self.other_words:
                    feedback(CONGRATS_WORDS[random.randint(0, len(CONGRATS_WORDS)-1)], False, False)
                    words_found.add(word)
                    result = True
                elif hash_word in self.pangrams:
                    feedback("PANGRAM!", False, True)
                    words_found.add(word)
                    pangrams_found.add(word)
                    window.increment_score(get_today_leaderboard_id(), 4)
                    window.increment_score(get_all_times_leaderboard_id(), 4)
                    result = True
                elif set(word).issubset(self.letters):
                    feedback(INCORRECT_WORDS[random.randint(0, len(INCORRECT_WORDS)-1)], True, False)
                else:
                    feedback(WRONG_LETTERS[random.randint(0, len(WRONG_LETTERS)-1)], True, False)
                clear_word()
                storage[f"words_found_{language}"] = ",".join(list(words_found))
                if result:
                    window.increment_score(get_today_leaderboard_id(), 1)
                    window.increment_score(get_all_times_leaderboard_id(), 1)
                return result
            
            @staticmethod
            def create_from_dict(dict):
                return HashedBee(set(dict[KEY_LETTERS]), dict[KEY_LETTERS][0], set(dict[KEY_PANGRAMS]), set(dict[KEY_OTHER_WORDS]))
                
            
        print_all = False
        write_file = False
        verbose = False
        search_bee = None
        diff_min = 10
        diff_max = 50
        date = datetime.date.today()
        day_of_week = date.weekday()
        url = None

        if locale.getlocale()[0] is None:
            locale.setlocale(locale.LC_ALL, '')
        if "language" in storage.keys() and storage["language"] in DEFAULT_WORD_LISTS.keys():
            language = storage["language"]
        elif locale.getlocale()[0] is not None and locale.getlocale()[0][0:2] in DEFAULT_WORD_LISTS.keys():
            language = locale.getlocale()[0][0:2]
        else:
            language = DEFAULT_LANGUAGE
            
        for lang_flag in document.get(name="lang"):
            lang_flag.checked = lang_flag.value == language
            

        try:
            opts, args = getopt.getopt(sys.argv[1:], "n:lwvg:s:d:u:m:M:", ["words-count", "list", "write", "verbose", "language", "search", "date", "url", "min", "max"])
        except getopt.GetoptError as err:
            print("error options")
            sys.exit(2)
        for o, a in opts:
            if o == "-n":
                diff = int(a)
                diff_min = diff - 5
                diff_max = diff +5
            if o == "-l":
                print_all = True
            if o == "-w":
                write_file = True
            if o == "-v":
                verbose = True
            elif o == "-g":
                language = a
            elif o == "-s":
                search_bee = a
            elif o == "-d":
                date = datetime.date.fromisoformat(a)
            elif o == "-u":
                url = a
            elif o == "-m":
                url = diff_min = a
            elif o == "-M":
                url = diff_max = a
                
        print(f"language: {language}")
                
        def generate_bees():
            start_time = datetime.datetime.now()
            words = load_words(DEFAULT_WORD_LISTS[language])
            bees = Bee.create_bees(words)
            end_time = datetime.datetime.now()
            print(f"Generated {len(bees)} bees in {(end_time - start_time).seconds}s from {len(words)} words")
            return bees

        def read_hashed_bees():
            path = bees_path()
            print(f"Reading bees file: {path}")
            word_file = open(path)
            json_data = json.load(word_file)
            bees = [HashedBee.create_from_dict(bee_dict) for bee_dict in json_data[KEY_BEES] if diff_min <= len(bee_dict[KEY_OTHER_WORDS]) <= diff_max]
            print(f"Read {len(bees)} hashed bees with {diff_min} to {diff_max} words")
            return bees
            
        def write_bees_file():
            bees = generate_bees()
            dict = {KEY_BEES: []}
            print("Creating bees dictionary")
            for b in bees:
                bee_dict = {KEY_LETTERS: b.show_letters(), KEY_PANGRAMS: [], KEY_OTHER_WORDS: []}
                for w in b.other_words:
                    bee_dict[KEY_OTHER_WORDS].append(hash(w))
                for w in b.pangrams:
                    bee_dict[KEY_PANGRAMS].append(hash(w))
                dict[KEY_BEES].append(bee_dict)
            print("Writing bees file")
            with open(bees_path(), "w") as word_file:
                json.dump(dict, word_file, indent = 1)

                
                
        button1 = document["button1"]
        button2 = document["button2"]
        button3 = document["button3"]
        button4 = document["button4"]
        button5 = document["button5"]
        button6 = document["button6"]
        buttonC = document["buttonC"]
        button1_text = button1.select("text")[0]
        button2_text = button2.select("text")[0]
        button3_text = button3.select("text")[0]
        button4_text = button4.select("text")[0]
        button5_text = button5.select("text")[0]
        button6_text = button6.select("text")[0]
        buttonC_text = buttonC.select("text")[0]
        sb_hive_input_content = document.select(".sb-hive-input-content")[0]
        sb_wordlist_items_pag = document.select(".sb-wordlist-items-pag")[0]
        sb_recent_words = document.select(".sb-recent-words")[0]
        sb_content_box = document.select(".sb-content-box")[0]
        sb_message_box = document.select(".sb-message-box")[0]
        progress_bar = document["progress-bar"]
        progress_text = document["progress-text"]
        leaderboard_btn = document["leaderboard-btn"]
        leaderboard_modal = document["leaderboard-modal"]
        account_modal = document["account-modal"]
        email_modal = document["email-modal"]
        scores_list_yesterday = document["scores-list-yesterday"]
        scores_list_today = document["scores-list-today"]
        scores_list_alltimes = document["scores-list-alltimes"]
        username_txts = document.select("#username")
        leaderboards_loading = document["leaderboards-loading"]
        
        
        if write_file:
            write_bees_file()
        elif print_all:
            bees = generate_bees()
            all_bees = ""
            index = 0
            for b in bees:
                all_bees += f"{index} - {b.hashed_str()}\n"
                index += 1
            pydoc.pager(all_bees)
        elif search_bee is not None:
            bees = generate_bees()
            bee = [b for b in bees if b.center == search_bee[0] and b.letters == set(search_bee)][0]
            print(bee)
        else:
            if not os.path.exists(bees_path()):
                print(f"First time playing in lang={language} -> generating bees file. This might take a few minutes.")
                write_bees_file()
            bees = read_hashed_bees()
            print(f"Spelling bee for {date}")
            seed = (date - datetime.datetime.utcfromtimestamp(0).date()).days
            print(f"Seed: {seed}")
            random.seed(seed)
            bee_index = random.randint(0, len(bees)-1)
            print(f"Bee number: {bee_index}")
            bee = bees[bee_index]
            print("Starting game")
            
            bee.guess()
        
        
        
        
        word = ""
        letters_ordered = bee.show_letters()
        
        def add_letter(letter: str):
            print(f"add_letter({letter.strip()})")
            global word
            word += letter.strip()
            update_word()
            
        def button1clicked(event):
            global button1_text
            add_letter(button1_text.text)
        
        def button2clicked(event):
            global button2_text
            add_letter(button2_text.text)
        
        def button3clicked(event):
            global button3_text
            add_letter(button3_text.text)
        
        def button4clicked(event):
            global button4_text
            add_letter(button4_text.text)
        
        def button5clicked(event):
            global button5_text
            add_letter(button5_text.text)
        
        def button6clicked(event):
            global button6_text
            add_letter(button6_text.text)
        
        def buttonCclicked(event):
            global buttonC_text
            add_letter(buttonC_text.text)
            
        def update_word_list():
            global sb_wordlist_items_pag, sb_recent_words
            sb_wordlist_items_pag.clear()
            sb_recent_words.clear()
            progress_text.text = f"{len(words_found)}/{len(bee.all_words())} words found"
            progress_bar.style = {"width": f"{len(words_found)/len(bee.all_words()) * 100}%"}
            for word in sorted(words_found):
                word_item = html.LI(word)
                if bee.is_pangram(word):
                    word_item.class_name = "rainbow-text"
                sb_wordlist_items_pag <= word_item
                sb_recent_words <= word_item.clone()
            
        def button_enter_clicked(event):
            correct = bee.try_guess(word)
            if correct:
                update_word_list()
            clear_word()
            
        def button_delete_clicked(event):
            global word
            word = word[:-1]
            update_word()
            
        def button_shuffle_clicked(event):
            print("shuffle")
            global letters_ordered
            letters_ordered = bee.show_letters()
            update_letters()
            
            
        def document_changed(event):
            match event.target.name:
                case "lang":
                    language = event.target.value
                    storage["language"] = event.target.value
                    document.location.reload()
                case "username":
                    window.change_username(event.target.value)
                    print(f"username_changed to {event.target.value}")
                    load_and_update_username()
            
        def button_expand_wordlist_clicked(event):
            if "sb-expanded" in sb_content_box.class_name:
                sb_content_box.class_name = "sb-content-box"
            else:
                sb_content_box.class_name = "sb-content-box sb-expanded"
                
                
        def update_leaderboard(scores_list, scores):
            
            medals = ["&#129351;", "&#129352;", "&#129353;"]
            
            for ind, user in enumerate(scores.keys()):
                medal = medals[ind] if ind < len(medals) else ""
                scores_list <= html.LI(f"{medal}{user}: {scores[user]}")
            
            leaderboards_loading.style.display = "none"
                
        def button_leaderboard_clicked(event):
            print("leaderboard_clicked")
            leaderboard_modal.style.display = "block";
            
            scores_list_today.clear()
            scores_list_yesterday.clear()
            scores_list_alltimes.clear()
            
            window.list_scores(get_today_leaderboard_id(), lambda scores : update_leaderboard(scores_list_today, scores.to_dict()))
            window.list_scores(get_yesterday_leaderboard_id(), lambda scores : update_leaderboard(scores_list_yesterday, scores.to_dict()))
            window.list_scores(get_all_times_leaderboard_id(), lambda scores : update_leaderboard(scores_list_alltimes, scores.to_dict()))
            
            window.display_leaderboard("Today")
            leaderboards_loading.style.display = "inline"
        
        def button_account_clicked(event):
            print("account_clicked")
            account_modal.style.display = "block";
            
        def button_email_connect_clicked(event):
            print("account_clicked")
            email_modal.style.display = "block";
            
            
        def button_modal_close_clicked(event):
            print("modal_close_clicked")
            close_modals()
            
        def window_clicked(event):
            if "modal" in event.target.class_name:
                close_modals()
                
        def close_modals():
            for modal in document.select(".modal"):
                modal.style.display = "none";
                
        def button_email_submit_clicked(event):
            window.connect_email(document["email-input"].value, document["password-input"].value)
            timer.set_timeout(on_email_submit_complete, 1000)
            
        def on_email_submit_complete():
            if window.error == "":
                update_email()
                load_and_update_username()
                close_modals()
            else:
                document["email-error-txt"].text = window.error
                document["email-error-txt"].style.display = "block"
                
        def clear_word():
            print("clear_word")
            global word
            word = ""
            update_word()
            
        def update_word():
            global sb_hive_input_content
            print(f"update label to {word}")
            sb_hive_input_content.clear()
            sb_hive_input_content.class_name = "sb-hive-input-content" if word == "" else "sb-hive-input-content non-empty"
            for letter in word:
                sb_hive_input_content <= html.SPAN(letter.strip(), Class="sb-input-bright" if letter.lower() == bee.center else "")
            
        def update_letters():
            global button1_text, button2_text, button3_text, button4_text, button5_text, button6_text, buttonC_text
            button1_text.text = letters_ordered[1]
            button2_text.text = letters_ordered[2]
            button3_text.text = letters_ordered[3]
            button4_text.text = letters_ordered[4]
            button5_text.text = letters_ordered[5]
            button6_text.text = letters_ordered[6]
            buttonC_text.text = letters_ordered[0]
            
        def update_username():
            print("update_username")
            for username_txt in username_txts:
                username_txt.value = window.username
                username_txt.text = window.username
            
        def update_email():
            if "email" in storage:
                document["email-txt"].text = storage["email"]
                document["email-connect-btn"].style.display = "None"
            else:
                document["email-txt"].text = "None"
                document["email-connect-btn"].style.display = "Block"
            
        def load_and_update_username():
            print("load_and_update_username")
            window.update_user()
            timer.set_timeout(update_username, 1000)
            
        def feedback(msg, isError, isPangram):
            class_name = "sb-message-box"
            if isPangram:
                class_name += " pangram-message"
            elif isError:
                class_name += " error-message"
            else:
                class_name += " success-message"
            sb_message_box.class_name = class_name
            sb_message_box.clear()
            sb_message_box <= html.SPAN(msg, Class="sb-message")

        button1.bind("click", button1clicked)
        button2.bind("click", button2clicked)
        button3.bind("click", button3clicked)
        button4.bind("click", button4clicked)
        button5.bind("click", button5clicked)
        button6.bind("click", button6clicked)
        buttonC.bind("click", buttonCclicked)
        document["button_enter"].bind("click", button_enter_clicked)
        document["button_delete"].bind("click", button_delete_clicked)
        document["button_shuffle"].bind("click", button_shuffle_clicked)
        document.select(".sb-toggle-expand")[0].bind("click", button_expand_wordlist_clicked)
        leaderboard_btn.bind("click", button_leaderboard_clicked)
        window.bind('click', window_clicked)
        document["account-btn"].bind('click', button_account_clicked)
        document["email-connect-btn"].bind('click', button_email_connect_clicked)
        document["email-submit"].bind('click', button_email_submit_clicked)
        
        document.bind('change', document_changed)
        
        print(".modal_close_btn")
        for close_btn in document.select(".modal-close-btn"):
            print(close_btn)
            close_btn.bind('click', button_modal_close_clicked)
        
        
        if "date" in storage and str(date) == storage["date"] and f"words_found_{language}" in storage:
            if storage[f"words_found_{language}"] != "":
                words_found = set(storage[f"words_found_{language}"].split(","))
        else:
            for lang in DEFAULT_WORD_LISTS.keys():
                storage[f"words_found_{lang}"] = ""
            storage["date"] = str(date)
        
        update_letters()
        update_word()
        update_word_list()
        update_email()
        load_and_update_username()
        
        </script>
        
        <div class="pz-game-field" id="pz-game-root">
           <div class="sb-content-box">
              <div class="sb-status-box">
                 <div class="sb-progress-box">
                    <span role="presentation">
                        <div class="w3-light-grey w3-round-large" id="progress-bar-container">
                            <div id="progress-text-container">
                                <div id="progress-text"></div>
                            </div>
                            <div id="progress-bar" class="w3-container w3-yellow w3-round-large" style="width:0%"></div>
                        </div>
                    </span>
                 </div>
                 <div class="sb-wordlist-box">
                    <div class="sb-wordlist-heading">
                       <div class="sb-wordlist-heading-wrap sb-touch-button">
                          <div class="sb-recent-words-wrap">
                             <ul class="sb-recent-words">
                                 <li>Loading...</li>
                             </ul>
                          </div>
                          <div class="sb-toggle-expand"><span class="sb-toggle-icon"></span></div>
                       </div>
                    </div>
                    <div class="sb-wordlist-drawer">
                       <div class="sb-wordlist-window">
                          <div class="sb-wordlist-pag">
                             <div class="sb-wordlist-scroll-anchor" style="left: 0%;"></div>
                             <ul class="sb-wordlist-items-pag">
                             </ul>
                          </div>
                          <div class="sb-kebob"></div>
                       </div>
                    </div>
                 </div>
              </div>
              <div class="sb-controls-box">
                 <div class="sb-controls">
                    <div class="sb-message-box"></div>
                    <div class="sb-hive-input">
                       <span class="sb-hive-input-content" style="font-size: 1em;"></span>
                       <div class="sb-hive-hidden-input"><span class="sb-hive-input-content" style="font-size: 1em;"></span></div>
                    </div>
                    <div class="sb-hive">
                       <div class="hive">
                          <svg id="buttonC" type="button" class="hive-cell center" viewBox="0 0 120 103.92304845413263" style="touch-action: manipulation;">
                             <polygon class="cell-fill" points="0,51.96152422706631 30,0 90,0 120,51.96152422706631 90,103.92304845413263 30,103.92304845413263" stroke="white" stroke-width="7.5"></polygon>
                             <text class="cell-letter" x="50%" y="50%" dy="0.35em"></text>
                          </svg>
                          <svg id="button1" type="button" class="hive-cell outer" viewBox="0 0 120 103.92304845413263" style="touch-action: manipulation;">
                             <polygon class="cell-fill" points="0,51.96152422706631 30,0 90,0 120,51.96152422706631 90,103.92304845413263 30,103.92304845413263" stroke="white" stroke-width="7.5"></polygon>
                             <text class="cell-letter" x="50%" y="50%" dy="0.35em"></text>
                          </svg>
                          <svg id="button2" type="button" class="hive-cell outer" viewBox="0 0 120 103.92304845413263" style="touch-action: manipulation;">
                             <polygon class="cell-fill" points="0,51.96152422706631 30,0 90,0 120,51.96152422706631 90,103.92304845413263 30,103.92304845413263" stroke="white" stroke-width="7.5"></polygon>
                             <text class="cell-letter" x="50%" y="50%" dy="0.35em"></text>
                          </svg>
                          <svg id="button3" type="button" class="hive-cell outer" viewBox="0 0 120 103.92304845413263" style="touch-action: manipulation;">
                             <polygon class="cell-fill" points="0,51.96152422706631 30,0 90,0 120,51.96152422706631 90,103.92304845413263 30,103.92304845413263" stroke="white" stroke-width="7.5"></polygon>
                             <text class="cell-letter" x="50%" y="50%" dy="0.35em"></text>
                          </svg>
                          <svg id="button4" type="button" class="hive-cell outer" viewBox="0 0 120 103.92304845413263" style="touch-action: manipulation;">
                             <polygon class="cell-fill" points="0,51.96152422706631 30,0 90,0 120,51.96152422706631 90,103.92304845413263 30,103.92304845413263" stroke="white" stroke-width="7.5"></polygon>
                             <text class="cell-letter" x="50%" y="50%" dy="0.35em"></text>
                          </svg>
                          <svg id="button5" type="button" class="hive-cell outer" viewBox="0 0 120 103.92304845413263" style="touch-action: manipulation;">
                             <polygon class="cell-fill" points="0,51.96152422706631 30,0 90,0 120,51.96152422706631 90,103.92304845413263 30,103.92304845413263" stroke="white" stroke-width="7.5"></polygon>
                             <text class="cell-letter" x="50%" y="50%" dy="0.35em"></text>
                          </svg>
                          <svg id="button6" type="button" class="hive-cell outer" viewBox="0 0 120 103.92304845413263" style="touch-action: manipulation;">
                             <polygon class="cell-fill" points="0,51.96152422706631 30,0 90,0 120,51.96152422706631 90,103.92304845413263 30,103.92304845413263" stroke="white" stroke-width="7.5"></polygon>
                             <text class="cell-letter" x="50%" y="50%" dy="0.35em"></text>
                          </svg>
                       </div>
                    </div>
                    <div class="hive-actions">
                       <div id="button_enter" type="button" class="hive-action hive-action__submit sb-touch-button" style="touch-action: manipulation;">Enter</div>
                       <div id="button_delete" type="button" class="hive-action hive-action__delete sb-touch-button" style="touch-action: manipulation;">Delete</div>
                       <div id="button_shuffle" type="button" class="hive-action hive-action__shuffle sb-touch-button" style="touch-action: manipulation;"></div>
                    </div>
                 </div>
              </div>
           </div>
        </div>
        
        
        
        
        <div class="custom-radios">
          <div>
            <input type="radio" id="lang-en" name="lang" value="en" checked="">
            <label for="lang-en">
              <span>
                <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/242518/check-icn.svg" alt="Checked Icon" width=100%>
              </span>
            </label>
          </div>
          
          <div>
            <input type="radio" id="lang-fr" name="lang" value="fr">
            <label for="lang-fr">
              <span>
                <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/242518/check-icn.svg" alt="Checked Icon">
              </span>
            </label>
          </div>
        </div>
        
        <div class="social-section" style="
            position: absolute;
            top: 6px;
            left: 14px;
            width: 50%;
            height: 50%;
        ">
            <button id="account-btn" type="button" style="padding: 0;border: 0; background-color: transparent;">
                <img src="user.png" height="20" width="20">
            </button>
            <input type="text" id="username" name="username" value="Loading..."> </input>

        </div>
        
        <button id="leaderboard-btn" type="button" style="padding: 0;border: 0; background-color: transparent; position: absolute; left: calc(50% - 10px); top: 5px;">
            <img src="championship-trophy.png" height="20" width="20">
        </button>
        
        <div id="leaderboard-modal" class="modal">

          <!-- Modal content -->
          <div class="modal-content">
            <span id="leaderboard-close-btn" class="modal-close-btn close" style="position: relative; top: -15; right: -5;">&times;</span>
            <h1 style="
                text-align: center;
                font-weight: bold;
                padding: 0 0 20 0;
            ">
                Leaderboards
                <img id="leaderboards-loading" src="https://c.tenor.com/I6kN-6X7nhAAAAAi/loading-buffering.gif" style="
                    display: none;
                    width: 20;
                    margin: 0 0 0 10;
                    position: relative;
                    top: 4;
                ">
            </h1>
            <div class="tab">
                <button class="tablinks" onclick="displayLeaderboard(event, 'Yesterday')" name="Yesterday">Yesterday</button>
                <button class="tablinks" onclick="displayLeaderboard(event, 'Today')" name="Today">Today</button>
                <button class="tablinks" onclick="displayLeaderboard(event, 'AllTimes')" name="AllTimes">All Times</button>
            </div>
              
            <div id="Yesterday" class="tabcontent">
                <ul id="scores-list-yesterday" style="padding: 10px;"><li>test1yes</li><li>test2yes</li></ul>
            </div>
              
            <div id="Today" class="tabcontent">
                <ul id="scores-list-today" style="padding: 10px;"><li>test1tod</li><li>test2tod</li></ul>
            </div>
              
            <div id="AllTimes" class="tabcontent">
                <ul id="scores-list-alltimes" style="padding: 10px;"><li>test1all</li><li>test2all</li></ul>
            </div>
          </div>

        </div>
        
        
        <div id="account-modal" class="modal">

            <!-- Modal content -->
            <div class="modal-content">
              
                <span id="account-close-btn" class="modal-close-btn close" style="position: relative; top: -15; right: -5;">&times;</span>
                <h1 style="
                    text-align: center;
                    font-weight: bold;
                    padding: 0 0 20 0;
                ">
                    Account
                    <img id="leaderboards-loading" src="https://c.tenor.com/I6kN-6X7nhAAAAAi/loading-buffering.gif" style="
                        display: none;
                        width: 20;
                        margin: 0 0 0 10;
                        position: relative;
                        top: 4;
                    ">
                </h1>
                
                <div if="account-info">
                    
                    <table style="width:100%">
                      <tr>
                        <th>Username:</th>
                        <td id="username"></td>
                      </tr>
                      <tr>
                        <th>Linked email:</th>
                        <td id="email">
                            <text id="email-txt">None</text>
                            <button id="email-connect-btn">Connect</button>
                        </td>
                      </tr>
                    </table>
                    
                </div>
              
            </div>
        </div>
        
        
        <div id="email-modal" class="modal">
            <div class="modal-content">
                
                  <span id="email-close-btn" class="modal-close-btn close" style="position: relative; top: -15; right: -5;">&times;</span>
                  <h1 style="
                      text-align: center;
                      font-weight: bold;
                      padding: 0 0 20 0;
                  ">
                      Connect Email Address
                      <img id="leaderboards-loading" src="https://c.tenor.com/I6kN-6X7nhAAAAAi/loading-buffering.gif" style="
                          display: none;
                          width: 20;
                          margin: 0 0 0 10;
                          position: relative;
                          top: 4;
                      ">
                  </h1>
                  
                  <div if="email-info">
                    <text id="email-error-txt" style="display: None; color: red;">Error message.</text>
                    <div class="form-group">
                      <label for="email">Email:</label>
                      <input type="email" class="form-control" id="email-input" placeholder="Enter email">
                    </div>
                    <div class="form-group">
                      <label for="pwd">Password:</label>
                      <input type="password" class="form-control" id="password-input" placeholder="Enter password">
                    </div>
                    <button type="button" id="email-submit">Connect</button>
                      
                  </div>
                
            </div>
        </div>

        
    </body>

</html>
